<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Kooboo CMS技术背景 | Kooboo CMS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. 语言平台Kooboo CMS基于.NET Framework 4.x，.NET Framework 4.x的一些技术特性成为站点开发人员使用Kooboo CMS必不可少的基础，为提升Kooboo CMS的用户体验来了极大的帮助，这些特别包括：

dynamic关键字带来了流畅的数据操作体验

.NET4带来的dynamic关键字，可实现部分的动态语言特性。在Kooboo CMS中，所有的内容">
<meta property="og:type" content="website">
<meta property="og:title" content="Kooboo CMS技术背景">
<meta property="og:url" content="http://www.kooboo.me/docs/technical-background/index.html">
<meta property="og:site_name" content="Kooboo CMS">
<meta property="og:description" content="1. 语言平台Kooboo CMS基于.NET Framework 4.x，.NET Framework 4.x的一些技术特性成为站点开发人员使用Kooboo CMS必不可少的基础，为提升Kooboo CMS的用户体验来了极大的帮助，这些特别包括：

dynamic关键字带来了流畅的数据操作体验

.NET4带来的dynamic关键字，可实现部分的动态语言特性。在Kooboo CMS中，所有的内容">
<meta property="og:updated_time" content="2016-12-31T10:11:57.056Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kooboo CMS技术背景">
<meta name="twitter:description" content="1. 语言平台Kooboo CMS基于.NET Framework 4.x，.NET Framework 4.x的一些技术特性成为站点开发人员使用Kooboo CMS必不可少的基础，为提升Kooboo CMS的用户体验来了极大的帮助，这些特别包括：

dynamic关键字带来了流畅的数据操作体验

.NET4带来的dynamic关键字，可实现部分的动态语言特性。在Kooboo CMS中，所有的内容">
  
    <link rel="alternate" href="/atom.xml" title="Kooboo CMS" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="http://fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/unslider/2.0.3/css/unslider.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?19a46999a8663e78e0474eecce13524b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


</head>

<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="logo" href="/">
        <img src="/images/logo.png" />
      </a>
      
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        <li><a href="/docs/" class="active">技术文档</a></li>
        <li><a href="/archives/">文章中心</a></li>
        <li><a href="/extensions/">CMS拓展</a></li>
        <li><a href="/downloads/">下载中心</a></li>
        <li><a href="/about/">关于我们</a></li>
        <li><a href="https://github.com/Tsingbo-Kooboo/KoobooMvc5" target="_blank">获取源码</a></li>
        </ul>
      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
    
  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Kooboo CMS</h1>
  
</div>

    <div class="row">
      
        <div class="col-sm-12 blog-main">
          <article id="page-undefined" class="article article-type-page" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      Kooboo CMS技术背景
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/docs/technical-background/index.html" class="article-date"><time datetime="2016-12-31T09:24:07.000Z" itemprop="datePublished">2016-12-31</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-语言平台"><a href="#1-语言平台" class="headerlink" title="1. 语言平台"></a>1. 语言平台</h2><p>Kooboo CMS基于.NET Framework 4.x，.NET Framework 4.x的一些技术特性成为站点开发人员使用Kooboo CMS必不可少的基础，为提升Kooboo CMS的用户体验来了极大的帮助，这些特别包括：</p>
<ul>
<li><h3 id="dynamic关键字带来了流畅的数据操作体验"><a href="#dynamic关键字带来了流畅的数据操作体验" class="headerlink" title="dynamic关键字带来了流畅的数据操作体验"></a>dynamic关键字带来了流畅的数据操作体验</h3></li>
</ul>
<p>.NET4带来的dynamic关键字，可实现部分的动态语言特性。在Kooboo CMS中，所有的内容都是以key-value的形式存在。在语言对象的表达中，我们使用IDictionary<string,object>类型的对象来表达每一条件内容数据。在这种情况下，我们常规的数据使用方法将会是：</string,object></p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">@<span class="keyword">foreach</span> (<span class="function"><span class="keyword">var</span> item <span class="title">in</span> (<span class="params">IEnumerable&lt;IDictionary&lt;<span class="keyword">string</span>,<span class="keyword">object</span>&gt;&gt;</span>)<span class="title">ViewData</span>(<span class="params"><span class="string">"Articles"</span></span>))</span></div><div class="line">&#123;</div><div class="line">	@item[<span class="string">"Title"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在引入dynamic对象之后，我们相同逻辑的代码可以简化为：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">@<span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> ViewBag.Articles)</div><div class="line">&#123;</div><div class="line">	@item.Title</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>首先，ViewBag是ASP.NET MVC3中为了方便站点开发人员使用而对ViewData对象的一个dynamic包装，包装之后，所有通过ViewBag访问的ViewData值都被认为是dynamic变量，这时我们不需要进行再一步的类型转换之后就可以调用它的属性和方法。</p>
<p>而用item.Title来代替item[“Title”]，也是我们为了适应dynamic的调用方式，继承实现DynamicObject和IDictionary<string, object="">（具体定义类型为：Kooboo.Dynamic.DynamicDictionary）。这样的调用方式一方面可以更直观的，另一方面可以让用户更流畅的使用内容的字段值。</string,></p>
<ul>
<li><h3 id="匿名对象是MVC相关辅助方法传参的基础"><a href="#匿名对象是MVC相关辅助方法传参的基础" class="headerlink" title="匿名对象是MVC相关辅助方法传参的基础"></a>匿名对象是MVC相关辅助方法传参的基础</h3></li>
</ul>
<p>匿名对象是.NET 3.5中带来的一个重要特性，它被大量的用在LINQ和MVC的辅助方法中。在用Kooboo CMS开发中，开发layout和view中使用最多的对象除了dynamic变量之外，另一个重要的对象使用方式就是匿名对象。最常用的就是我们在生成页面URL的时候需要指定参数，那我们会这样来生成：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><div class="line">@Url.FrontUrl().PageUrl(<span class="string">"Articles/detail"</span>, <span class="keyword">new</span> &#123;UserKey = item.UserKey&#125;)</div></pre></td></tr></table></figure>
<p>其中new { UserKey=item.UserKey }就是一个匿名对象，它所表达的含义就是向Articles/Detail这个页面传递UserKey参数，值是item.UserKey的值。如果此时，还需要传递一个参数可以用：new { UserKey=item.Userkey,Title=item.UserKey}，各参数之间以逗号分隔，以此类推。</p>
<h2 id="2-依赖注入的解决方案"><a href="#2-依赖注入的解决方案" class="headerlink" title="2. 依赖注入的解决方案"></a>2. 依赖注入的解决方案</h2><p>Kooboo CMS一直在致力于寻找最简单轻量的解决方案来做功能设计和技术实现。在Kooboo CMS中，我们的依赖注入使用上可通过添加Dependency这个Attribute的方式来实现。这种注入方式主要用在数据库储存储切换，模板引擎切换等地方。例如以下是用来替换RepositoryProvider的默认实现：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">using System;</div><div class="line">using System.Collections.Generic;</div><div class="line">using System.Linq;</div><div class="line">using System.Text;</div><div class="line">using Kooboo.CMS.Common;</div><div class="line">using Kooboo.CMS.Content.Models;</div><div class="line">using Kooboo.CMS.Common.Runtime.Dependency;</div><div class="line">namespace Kooboo.CMS.Content.Persistence.SqlServer</div><div class="line">&#123;</div><div class="line">    [Dependency(typeof(IRepositoryProvider), Order = 2)]</div><div class="line">    [Dependency(typeof(Kooboo.CMS.Common.Persistence.Non_Relational.IProvider&lt;Repository&gt;), Order = 2)]</div><div class="line">    public class RepositoryProvider : Kooboo.CMS.Content.Persistence.Default.RepositoryProvider</div><div class="line">    &#123;</div><div class="line">        public RepositoryProvider(IBaseDir baseDir)</div><div class="line">            : base(baseDir) &#123; &#125;</div><div class="line"></div><div class="line">        public override void Add(Models.Repository item)</div><div class="line">        &#123;</div><div class="line">            base.Add(item);</div><div class="line">            DatabaseHelper.InitializeDatabase(item);</div><div class="line">        &#125;</div><div class="line">        public override void Remove(Models.Repository item)</div><div class="line">        &#123;</div><div class="line">            try</div><div class="line">            &#123;</div><div class="line">                DatabaseHelper.DisposeDatabase(item);</div><div class="line">            &#125;</div><div class="line">            catch</div><div class="line">            &#123;&#125;</div><div class="line">            base.Remove(item);</div><div class="line">        &#125;</div><div class="line">        public override void Initialize(Models.Repository repository)</div><div class="line">        &#123;</div><div class="line">            DatabaseHelper.InitializeDatabase(repository);</div><div class="line">            base.Initialize(repository);</div><div class="line">        &#125;</div><div class="line">        public override bool TestDbConnection()</div><div class="line">        &#123;</div><div class="line">            var shareConnectionString = SqlServerSettings.Instance.SharingDatabaseConnectionString;</div><div class="line">            return SQLServerHelper.TestConnection(shareConnectionString);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-存储模型"><a href="#3-存储模型" class="headerlink" title="3. 存储模型"></a>3. 存储模型</h2><ul>
<li><h3 id="存储模型设计"><a href="#存储模型设计" class="headerlink" title="存储模型设计"></a>存储模型设计</h3></li>
</ul>
<p>对于关系的处理，在Kooboo CMS中，对View，Layout，Page，Folder等数据有限且有明确层级关系的数据，尽量使用文件夹层级的关系来表现数据之间的子父和继承关系。这样做，可以做简单，直观的效果外，还方便站点开发人员开发时使用Visual Studio对View进行编辑和修改。</p>
<ul>
<li><h3 id="配置数据与内容数据分开存储"><a href="#配置数据与内容数据分开存储" class="headerlink" title="配置数据与内容数据分开存储"></a>配置数据与内容数据分开存储</h3></li>
</ul>
<p>在Kooboo CMS中，一个站点由两部分组成：站点管理和内容管理。这两部分数据有着明显的不同：</p>
<ol>
<li>站点配置数据，包括View,Layout,Page等数据，这些数据都有一个共同的特点，数据量不是特别大，不需要很复杂的查询。</li>
<li>内容数据，通常数量会比较大，也会有各种复杂查询。同时对于一个内容管理系统来说，通常还会要求支持各种不同的数据库平台。</li>
</ol>
<p>针对配置数据和内容数据的不同特点，我们采取了不同的存储策略：</p>
<ol>
<li>对配置数据，我们将数据存储在XML文件中，方便部署,维护和导出。配合数据缓存机制来解决有可能出现的性能问题。</li>
<li>对文本内容数据，我们采用一套的透明的接口来隔离存储实现， 让内容数据可以支持不同数据库引擎。目前我们支持：XML,MongoDB,SqlServer,SqlCe,MySQL,Couchbase等数据库。为了减少部署成本，我们默认使用XML存储，用户安装Kooboo CMS完全不需要任何额外的数据库配置。</li>
<li>对媒体内容数据，默认我们将媒体内容（比如图片、视频、文档等）存储在磁盘中。同时我们也支持将媒体内容存储在Azure Blob Storage中或者自己搭建的文件系统中（通常用于多服务器负载均衡时使用共同的媒体中心）。</li>
</ol>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://www.kooboo.me/docs/technical-background/index.html" data-id="cixiw10j2000958ld3edpq7t6" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
    

  
</article>




        </div>
      
    </div>
  </div>
    
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      copyright &copy; 2017 风情波涌
      <a href="http://www.miibeian.gov.cn/" target="_blank">闽ICP备16035825号</a>
      <br/>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="//cdn.bootcss.com/unslider/2.0.3/js/unslider-min.js"></script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

</body>
</html>
